name: Push to AzureRegistry
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Build and push reids contracts
      env:
        REGISTRY_URL: generalregistry.azurecr.io
      run: |
          eval $(echo "export VERSION=$(cat lerna.json | grep version | sed -n 's/.* "\(.*\)".*/\1/p')")
          cd contracts/
          docker build -t reids/contracts .
          docker tag reids/contracts:latest $REGISTRY_URL/reids/contracts:$VERSION
          docker login -u '${{ secrets.clientid }}' -p '${{ secrets.clientpw }}' $REGISTRY_URL
          docker push ${REGISTRY_URL}/reids/contracts:${VERSION}

